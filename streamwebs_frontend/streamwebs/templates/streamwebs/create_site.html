{% extends 'streamwebs/base.html' %}
{% load i18n %}
{% load staticfiles %}

{% block scripts %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyBV71HBuAFMtHEAaSEVpRDPUQyGvJwTX1k"></script>
<script type="application/javascript" src="{% static 'streamwebs/js/create_site.js' %}"></script>
<script>

$(document).ready(function() {
  document.getElementById("site_form").reset();
  var markers = [];
  var myLatLng = new google.maps.LatLng(44, -120);
  var map = new google.maps.Map(document.getElementById('map'), {
    zoom: 6,
    center: myLatLng
  });

  google.maps.event.addListener(map, 'click', function(e){
    placeMarker(e.latLng, map);
  });

  function clearMarkers(){
    console.log(markers[0]);
    if(markers[0]!== undefined){
      console.log('yes');
      markers[0].setMap(null);
      markers.pop();
    }
  }

  function placeMarker(position, map) {
    clearMarkers();
    var marker = new google.maps.Marker({
      position: position,
      map: map
    });
    markers.push(marker);
    map.panTo(position);
    $('#input_lat').val(position.lat());
    $('#input_lng').val(position.lng());

  }
});

</script>
{% endblock %}

{% block body_title %} Add a New Site {% endblock %}

{% block content %}
<form id='site_form' method='post' enctype="multipart/form-data">
  {% csrf_token %}
  {{ site_form.media }}
  <div class="row">
    <div class="input-field col s12">
      <i class="material-icons prefix">flag</i>
      <label for="{{ site_form.site_name.id_for_label }}">Site Name:</label>
      {{ site_form.site_name }}
      {{ site_form.site_name.errors | striptags }}

    </div>
  </div>

  <div class="row">
    <div class="input-field col s12">
      <i class="material-icons prefix">sort</i>
      <label for="{{ site_form.description.id_for_label }}">Description:</label>
      {{ site_form.description }}
      {{ site_form.description.errors | striptags }}
    </div>
  </div>

  <input type="hidden" id="input_lat" name="lat">
  <input type="hidden" id="input_lng" name="lng">

  <p>

    <label for="id_image">Image:</label>
    <input id="id_image" name="image" type="file">
    {{ site_form.image.errors | striptags }}
  </p>


  <div id="map"> </div>
  {{ site_form.location.errors | striptags}}

  <input class="btn waves-effect waves-light teal darken-4" type='submit' name='submit' value='{% trans 'Add new site' %}'/>


</form>
{% endblock %}
